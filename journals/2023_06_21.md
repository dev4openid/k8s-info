- ## Organising your components with K8s Namespaces (01:46:16)
- ### K8s Namespaces explained
- Default `kubectl get namespace`  ---> 4 namespaces by default
	- NAME              STATUS     AGE
	- default           Active     12h
	  kube-node-lease   Active     12h  ---> heartbeat of nodes
	  kube-public       Active     12h ---> `kubectl cluster-info` will give you key info
	  kube-system       Active     12h  ---> leave alone
- Create namespace `kubectl create namespace my-namespace`  BUT better in configmap file!
- e.g.:
	- ```
	  apiVersion: v1
	  kind: ConfigMap
	  metadata:
	    name: mongodb-configmap
	    namespace: my-namespace     # note this to ensure correct namespace is enforced
	  data:
	    database-url: mongodb-service
	  ```
- Usecase to use namespace
	- associate types of resources in a group e.g. Database / Monitoring / Elastic Stack
	- Conflicts between teams, same application (but different deployment)
	- Staging vs Development using common "services"
	- Production "Blue" and "Green"
	- Team Access and Resource Limits on namespaces. Limit CPU/RAM/Storage by a team on a common resource ("out of balance between teams")
- ### Access Service in another namespace
	- Each namespace must have on configmap and/or secret to access common resource (e.g. database)
	- service can be common to more than one namespace
	- ```
	  apiVersion: v1
	  kind: ConfigMap
	  metadata:
	    name: mongodb-configmap
	  data: 
	    database-url: mongodb-service.database   #  NOTE: the suffix  .database 
	                                             # to facilitate common usage between teams
	  ```
- Components that cannot be created in a namespace
	- vol
	- node
	- `kubectl api-resources --namespaced=false`
	- ```
	  NAME                              SHORTNAMES   APIVERSION                             NAMESPACED   KIND
	  componentstatuses                 cs           v1                                     false        ComponentStatus
	  namespaces                        ns           v1                                     false        Namespace
	  nodes                             no           v1                                     false        Node
	  persistentvolumes                 pv           v1                                     false        PersistentVolume
	  mutatingwebhookconfigurations                  admissionregistration.k8s.io/v1        false        MutatingWebhookConfiguration
	  validatingwebhookconfigurations                admissionregistration.k8s.io/v1        false        ValidatingWebhookConfiguration
	  customresourcedefinitions         crd,crds     apiextensions.k8s.io/v1                false        CustomResourceDefinition
	  apiservices                                    apiregistration.k8s.io/v1              false        APIService
	  tokenreviews                                   authentication.k8s.io/v1               false        TokenReview
	  selfsubjectaccessreviews                       authorization.k8s.io/v1                false        SelfSubjectAccessReview
	  selfsubjectrulesreviews                        authorization.k8s.io/v1                false        SelfSubjectRulesReview
	  subjectaccessreviews                           authorization.k8s.io/v1                false        SubjectAccessReview
	  certificatesigningrequests        csr          certificates.k8s.io/v1                 false        CertificateSigningRequest
	  flowschemas                                    flowcontrol.apiserver.k8s.io/v1beta3   false        FlowSchema
	  prioritylevelconfigurations                    flowcontrol.apiserver.k8s.io/v1beta3   false        PriorityLevelConfiguration
	  ingressclasses                                 networking.k8s.io/v1                   false        IngressClass
	  runtimeclasses                                 node.k8s.io/v1                         false        RuntimeClass
	  clusterrolebindings                            rbac.authorization.k8s.io/v1           false        ClusterRoleBinding
	  clusterroles                                   rbac.authorization.k8s.io/v1           false        ClusterRole
	  priorityclasses                   pc           scheduling.k8s.io/v1                   false        PriorityClass
	  csidrivers                                     storage.k8s.io/v1                      false        CSIDriver
	  csinodes                                       storage.k8s.io/v1                      false        CSINode
	  storageclasses                    sc           storage.k8s.io/v1                      false        StorageClass
	  volumeattachments                              storage.k8s.io/v1                      false        VolumeAttachment
	  ```
	- `kubectl api-resources --namespaced=false` does the opposite in these can be used in any namespace
- Note: use ==kubens== to change default from "default" to the namespace you have created; use `brew install kubectx`
- ## K8s Ingress explained (02:01:52)
- External Service vs. Ingress
	- Place Ingress in front of "external service" (which become internal); this way anyone with the url can access the application (via the external service) via the Ingress (which masks the k8s internals)
- Ingres yaml:
- ![Ingres mapping to "external service"](/home/briandanks/Pictures/Screenshots/Screenshot from 2023-06-21 18-38-45.png)
- Ingres mapping to "external service" (now converted to an internal service)
- Note the url is http (not https) and the e.g. is browser my-app.com points to the host (in Ingress)
- ### Converting external service to internal service (to support Ingress)
- In the Service the nodePort is removed AND
- the spec - type is not Loadbalancer but ClusterIP  (NB: the internal service has "built-in loadbalancer")
- Ingress host must be a valid domain name!
- Note: Ingress sets up ==mapping== to access internal service etc.
- Require an Ingress Controller Pod (which is mapped to Ingress)
	- which evaluates and processes Ingress rules - entrypoint to K8s cluster and is part of the cluster
- ![Ingress Controller to Ingress](/home/briandanks/Pictures/Screenshots/Screenshot from 2023-06-21 18-51-47.png)
- Ingress Controller to Ingress
- There are many Ingress Controllers (e.g.  [NGINX Ingress Controller for Kubernetes](https://www.nginx.com/products/nginx-ingress-controller/), [Traefik Kubernetes Ingress provider](https://doc.traefik.io/traefik/providers/kubernetes-ingress/))  refer to https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/
- If using minikube invoke `Ì€minikube addons enable ingress` resulting:
	- ```  
	  addons enable ingress 
	  ðŸ’¡  ingress is an addon maintained by Kubernetes. For any concerns contact minikube on GitHub.
	  You can view the list of minikube maintainers at: https://github.com/kubernetes/minikube/blob/master/OWNERS
	      â–ª Using image registry.k8s.io/ingress-nginx/controller:v1.7.0
	      â–ª Using image registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20230312-helm-chart-4.5.2-28-g66a760794
	      â–ª Using image registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20230312-helm-chart-4.5.2-28-g66a760794
	  ðŸ”Ž  Verifying ingress addon...
	  ðŸŒŸ  The 'ingress' addon is enabled
	  ```
	- which is the implementation of the [NGINX Ingress Controller for Kubernetes](https://www.nginx.com/products/nginx-ingress-controller/) in minikube
	- from `kubectl get pod -n kube-system` check results in
	- ``` 
	  kubectl get pod -n kube-system  
	  NAME                               READY   STATUS    RESTARTS   AGE
	  coredns-787d4945fb-f6nll           1/1     Running   0          8h
	  etcd-minikube                      1/1     Running   0          8h
	  kube-apiserver-minikube            1/1     Running   0          8h
	  kube-controller-manager-minikube   1/1     Running   0          8h
	  kube-proxy-8knbz                   1/1     Running   0          8h
	  kube-scheduler-minikube            1/1     Running   0          8h
	  storage-provisioner                1/1     Running   0          8h
	  ```
	-
-